apiVersion: apps/v1
kind: Deployment
metadata:
  name: pihole
spec:
  replicas: 1
  selector:
    matchLabels:
      app: pihole

  template:
    metadata:
      labels:
        app: pihole


    spec:
      # securityContext:
      #   fsGroup: <user-id>
      #   runAsUser: <user-id>
      #   runAsGroup: <user-id>

      containers:
        - name: pihole

          image: pihole/pihole:2025.04.0

          envFrom:
            - configMapRef:
                name: pihole-configmap

          ports:
              - containerPort: 53
                protocol: UDP
              - containerPort: 53
                protocol: TCP
              - containerPort: 80
                name: http
                protocol: TCP
              - containerPort: 443
                name: https
                protocol: TCP

          volumeMounts:
            - mountPath: /etc/pihole
              name: pihole-storage

      restartPolicy: Always

      volumes:
        - name: pihole-storage
          persistentVolumeClaim:
            claimName: pihole-storage